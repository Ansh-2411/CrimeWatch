{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{MapContainer,TileLayer,Marker,Popup,useMap}from\"react-leaflet\";import\"leaflet/dist/leaflet.css\";import L from\"leaflet\";// Fix Leaflet marker icon issue\nimport markerIcon from\"leaflet/dist/images/marker-icon.png\";import markerShadow from\"leaflet/dist/images/marker-shadow.png\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const customIcon=new L.Icon({iconUrl:markerIcon,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41]});// Component to update map center dynamically\nconst ChangeView=_ref=>{let{center,shouldUpdate}=_ref;const map=useMap();if(shouldUpdate&&center){map.setView(center,map.getZoom());}return null;};const CurrentLocationMap=_ref2=>{var _markerPosition$,_markerPosition$2;let{formData,onLocationSelect}=_ref2;const[initialLocation,setInitialLocation]=useState(null);const[markerPosition,setMarkerPosition]=useState(null);const[address,setAddress]=useState(\"Fetching location...\");const[error,setError]=useState(null);const[loading,setLoading]=useState(true);const[shouldUpdateMapCenter,setShouldUpdateMapCenter]=useState(true);// Fetch address from coordinates\nconst fetchAddress=async(lat,lon)=>{try{const response=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);const data=await response.json();const locationName=data.display_name||\"Unknown Location\";setAddress(locationName);// Update parent component with location data\nif(onLocationSelect){onLocationSelect([lat,lon],locationName);}}catch(err){setAddress(\"Unable to fetch location name\");console.error(\"Error fetching address:\",err);}};useEffect(()=>{if(!navigator.geolocation){setError(\"Geolocation is not supported by your browser\");setLoading(false);return;}navigator.geolocation.getCurrentPosition(position=>{const lat=position.coords.latitude;const lon=position.coords.longitude;setInitialLocation([lat,lon]);setMarkerPosition([lat,lon]);// Set marker to current location\nfetchAddress(lat,lon);setLoading(false);},error=>{setError(`Error getting location: ${error.message}`);setLoading(false);});},[]);// Handle marker drag event\nconst handleMarkerDrag=event=>{const{lat,lng}=event.target.getLatLng();setMarkerPosition([lat,lng]);fetchAddress(lat,lng);};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[loading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loading your location...\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500\",children:error}),!loading&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm space-y-1\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Selected Address:\"}),\" \",address]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Coordinates:\"}),\" \",markerPosition===null||markerPosition===void 0?void 0:(_markerPosition$=markerPosition[0])===null||_markerPosition$===void 0?void 0:_markerPosition$.toFixed(6),\", \",markerPosition===null||markerPosition===void 0?void 0:(_markerPosition$2=markerPosition[1])===null||_markerPosition$2===void 0?void 0:_markerPosition$2.toFixed(6)]})]}),initialLocation&&/*#__PURE__*/_jsx(\"div\",{style:{height:\"300px\",width:\"100%\"},children:/*#__PURE__*/_jsxs(MapContainer,{center:initialLocation,zoom:15,scrollWheelZoom:true,style:{height:\"100%\",width:\"100%\"},children:[/*#__PURE__*/_jsx(ChangeView,{center:markerPosition,shouldUpdate:shouldUpdateMapCenter}),/*#__PURE__*/_jsx(TileLayer,{attribution:\"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\",url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"}),/*#__PURE__*/_jsx(Marker,{position:markerPosition,draggable:true,eventHandlers:{dragend:handleMarkerDrag},icon:customIcon,children:/*#__PURE__*/_jsxs(Popup,{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Drag me to set location\"}),/*#__PURE__*/_jsx(\"br\",{}),address]})})]})})]});};export default CurrentLocationMap;","map":{"version":3,"names":["React","useState","useEffect","MapContainer","TileLayer","Marker","Popup","useMap","L","markerIcon","markerShadow","jsx","_jsx","jsxs","_jsxs","customIcon","Icon","iconUrl","shadowUrl","iconSize","iconAnchor","ChangeView","_ref","center","shouldUpdate","map","setView","getZoom","CurrentLocationMap","_ref2","_markerPosition$","_markerPosition$2","formData","onLocationSelect","initialLocation","setInitialLocation","markerPosition","setMarkerPosition","address","setAddress","error","setError","loading","setLoading","shouldUpdateMapCenter","setShouldUpdateMapCenter","fetchAddress","lat","lon","response","fetch","data","json","locationName","display_name","err","console","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","message","handleMarkerDrag","event","lng","target","getLatLng","className","children","toFixed","style","height","width","zoom","scrollWheelZoom","attribution","url","draggable","eventHandlers","dragend","icon"],"sources":["/Users/ansh/Documents/Oddo/client/src/components/Map/Map.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from \"react-leaflet\";\nimport \"leaflet/dist/leaflet.css\";\nimport L from \"leaflet\";\n\n// Fix Leaflet marker icon issue\nimport markerIcon from \"leaflet/dist/images/marker-icon.png\";\nimport markerShadow from \"leaflet/dist/images/marker-shadow.png\";\n\nconst customIcon = new L.Icon({\n  iconUrl: markerIcon,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n});\n\n// Component to update map center dynamically\nconst ChangeView = ({ center, shouldUpdate }) => {\n  const map = useMap();\n  if (shouldUpdate && center) {\n    map.setView(center, map.getZoom());\n  }\n  return null;\n};\n\nconst CurrentLocationMap = ({ formData, onLocationSelect }) => {\n  const [initialLocation, setInitialLocation] = useState(null);\n  const [markerPosition, setMarkerPosition] = useState(null);\n  const [address, setAddress] = useState(\"Fetching location...\");\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [shouldUpdateMapCenter, setShouldUpdateMapCenter] = useState(true);\n\n  // Fetch address from coordinates\n  const fetchAddress = async (lat, lon) => {\n    try {\n      const response = await fetch(\n        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`\n      );\n      const data = await response.json();\n      const locationName = data.display_name || \"Unknown Location\";\n      setAddress(locationName);\n      \n      // Update parent component with location data\n      if (onLocationSelect) {\n        onLocationSelect([lat, lon], locationName);\n      }\n    } catch (err) {\n      setAddress(\"Unable to fetch location name\");\n      console.error(\"Error fetching address:\", err);\n    }\n  };\n\n  useEffect(() => {\n    if (!navigator.geolocation) {\n      setError(\"Geolocation is not supported by your browser\");\n      setLoading(false);\n      return;\n    }\n\n    navigator.geolocation.getCurrentPosition(\n      (position) => {\n        const lat = position.coords.latitude;\n        const lon = position.coords.longitude;\n        setInitialLocation([lat, lon]);\n        setMarkerPosition([lat, lon]); // Set marker to current location\n        fetchAddress(lat, lon);\n        setLoading(false);\n      },\n      (error) => {\n        setError(`Error getting location: ${error.message}`);\n        setLoading(false);\n      }\n    );\n  }, []);\n\n  // Handle marker drag event\n  const handleMarkerDrag = (event) => {\n    const { lat, lng } = event.target.getLatLng();\n    setMarkerPosition([lat, lng]);\n    fetchAddress(lat, lng);\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      {loading && <p className=\"text-gray-500\">Loading your location...</p>}\n      {error && <p className=\"text-red-500\">{error}</p>}\n\n      {!loading && (\n        <div className=\"text-sm space-y-1\">\n          <p><strong>Selected Address:</strong> {address}</p>\n          <p>\n            <strong>Coordinates:</strong> {markerPosition?.[0]?.toFixed(6)}, {markerPosition?.[1]?.toFixed(6)}\n          </p>\n        </div>\n      )}\n\n      {initialLocation && (\n        <div style={{ height: \"300px\", width: \"100%\" }}>\n          <MapContainer\n            center={initialLocation}\n            zoom={15}\n            scrollWheelZoom\n            style={{ height: \"100%\", width: \"100%\" }}\n          >\n            <ChangeView center={markerPosition} shouldUpdate={shouldUpdateMapCenter} />\n            <TileLayer\n              attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n              url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n            />\n            <Marker\n              position={markerPosition}\n              draggable={true}\n              eventHandlers={{ dragend: handleMarkerDrag }}\n              icon={customIcon}\n            >\n              <Popup>\n                <b>Drag me to set location</b>\n                <br />\n                {address}\n              </Popup>\n            </Marker>\n          </MapContainer>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default CurrentLocationMap;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}